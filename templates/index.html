<!DOCTYPE html>
<html>
<head>
    <title>CRYPTORATS_bot</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        /* [Tous tes styles CSS d'origine - inchang√©s] */
        body {
            font-family: 'Segoe UI', sans-serif;
            margin: 0;
            padding-bottom: 60px;
            background-color: #f5f5f5;
        }
        /* ... (le reste de ton CSS original) ... */
    </style>
</head>
<body>
    <div id="telegram-alert" class="telegram-alert">
        ‚ö†Ô∏è Ouvrez cette application via @CRYPTORATS_bot !
    </div>

    <div id="app-content" style="display:none;">
        <!-- [Tout ton contenu HTML existant] -->
        <div id="main-section" class="section active">
            <h1>Vos Points</h1>
            <div id="balance-display">Chargement en cours...</div>
            <button id="claim-btn">üéÅ R√©clamer des points</button>
        </div>
        <!-- ... (le reste de ton HTML) ... -->
    </div>

    <script>
        // ==================== SOLUTION URGENCE ====================
        function initApp() {
            const tgWebApp = window.Telegram?.WebApp;
            
            if (tgWebApp?.initDataUnsafe?.user) {
                tgWebApp.expand();
                tgWebApp.ready();
                document.getElementById('telegram-alert').style.display = 'none';
                document.getElementById('app-content').style.display = 'block';
                return tgWebApp.initDataUnsafe.user.id.toString();
            } else {
                setTimeout(() => {
                    window.location.href = "https://t.me/CRYPTORATS_bot";
                }, 2000);
                return null;
            }
        }

        // ==================== FONCTIONS API (version simplifi√©e) ====================
        async function loadUserData() {
            try {
                // Solution de repli si l'API √©choue
                document.getElementById('balance-display').innerHTML = `
                    <strong>Solde actuel:</strong> <span id="live-balance">0</span> points
                `;
            } catch (e) {
                console.error("Erreur balance:", e);
            }
        }

        async function loadTasks() {
            try {
                // Tasks par d√©faut si l'API ne r√©pond pas
                const defaultTasks = [
                    {
                        task_name: "Rejoindre le channel",
                        description: "Abonnez-vous √† notre channel Telegram",
                        points: 50,
                        url: "https://t.me/CRYPTORATS_annonces"
                    },
                    {
                        task_name: "Follow Twitter",
                        description: "Suivez-nous sur Twitter",
                        points: 30,
                        url: "https://twitter.com/CRYPTORATS_off"
                    }
                ];

                let html = '';
                defaultTasks.forEach(task => {
                    html += `
                    <div class="task-card">
                        <h3>${task.task_name}</h3>
                        <p>${task.description}</p>
                        <span class="points-badge">${task.points} pts</span>
                        <a href="${task.url}" target="_blank" class="task-btn">Commencer</a>
                    </div>`;
                });
                document.getElementById('tasks-list').innerHTML = html;
            } catch (e) {
                console.error("Erreur tasks:", e);
            }
        }

        // ==================== INITIALISATION ====================
        document.addEventListener('DOMContentLoaded', () => {
            const userId = initApp();
            if (userId) {
                loadUserData();
                loadTasks();
            }
        });
    </script>
</body>
</html>